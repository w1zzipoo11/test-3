// ---- TRANSLATIONS ----
const translations = {
  ua: {
    "nav-brand-main": "Memory Borodianka",
    "nav-brand-sub": "Історія пам’ятника Шевченку",
    "nav-link-about": "Про пам’ятник",
    "nav-link-timeline": "Хронологія",
    "nav-link-beforeafter": "До / Після",
    "nav-link-gallery": "Галерея",
    "nav-link-memory": "Пам’ять",
    "nav-cta": "Дивитися свідчення",

    "hero-kicker": "Бородянка · 2022 · пам’ять про незламність",
    "hero-title-line1": "Пам’ятник Шевченку,",
    "hero-title-line2": "який не зміг зламати обстріл.",
    "hero-subtitle":
      "У Бородянці погруддя Тараса Шевченка було розстріляне під час російських атак, але вціліле обличчя поета стало символом незламності. Цей сайт — цифровий простір пам’яті про удар по культурі, який не став перемогою ворога.",
    "hero-cta-primary": "Побачити руйнування",
    "hero-cta-secondary": "Дізнатись контекст",
    "hero-meta-1": "Реальні фото до та після обстрілів.",
    "hero-meta-2": "Сайт можна використати як основу онлайн-музею.",

    "hero-card-label": "Війна проти культури",
    "hero-card-time": "Березень 2022",
    "hero-thumb-before-label": "До вторгнення",
    "hero-thumb-after-label": "Після обстрілу",
    "hero-progress-title": "Документування руйнувань",
    "hero-progress-subtitle": "цифрова реставрація памʼяті",

    "about-kicker": "про пам’ятник",
    "about-title": "Один монумент — тисячі прочитань війни.",
    "about-text-1":
      "До повномасштабного вторгнення пам’ятник Тарасу Шевченку в Бородянці був звичайною точкою на мапі містечка: місце зустрічей, святкових подій, спільних фотографій.",
    "about-text-2":
      "У березні 2022 року російські війська обстрілюють Бородянку. Погруддя Шевченка розстрілюють, але обличчя поета дивом лишається неушкодженим. Цей образ стає одним із символів незламності України.",
    "about-text-3":
      "Цей сайт не є офіційним музейним ресурсом. Це навчальний digital-проєкт, який можна доповнювати: додавати більше фото, відео, свідчень, посилань на джерела.",
    "about-list-1": "Використовуй як основу для шкільного чи студентського проєкту.",
    "about-list-2": "Додай QR-код у просторі міста й веди людей на цей сайт.",
    "about-list-3": "Розширюй розділами про інші зруйновані об’єкти Бородянки.",

    "timeline-kicker": "хронологія",
    "timeline-title": "Як один постамент став символом опору.",
    "timeline-item-1-label": "до вторгнення",
    "timeline-item-1-text":
      "Пам’ятник сприймається як звичайний елемент простору: поруч проходять, не завжди помічаючи, але він тихо нагадує про поета, який писав про волю й гідність.",
    "timeline-item-2-label": "березень 2022",
    "timeline-item-2-text":
      "Під час російської окупації Бородянки пам’ятник розстрілюють. Пошкоджений постамент, уламки, але обличчя Шевченка залишається цілим — як немий докір загарбникам.",
    "timeline-item-3-label": "після деокупації",
    "timeline-item-3-text":
      "Фото зруйнованого пам’ятника розлітаються світом. Журналісти, волонтери, дослідники війни використовують цей образ, щоб показати: агресія спрямована проти самої ідентичності.",
    "timeline-note":
      "Для точних дат, посилань на джерела та документів цей макет можна доповнити архівними матеріалами, репортажами та офіційними звітами.",

    "ba-kicker": "візуальне свідчення",
    "ba-title": "До і після обстрілу.",
    "ba-subtitle":
      "Перетягни повзунок, щоб побачити, як змінюється простір. Ліворуч — те, що було. Праворуч — те, що залишила по собі війна.",
    "ba-label-before": "До",
    "ba-label-after": "Після",
    "ba-text-1":
      "Руйнування пам’ятників — це не випадковість. Це цілеспрямована спроба стерти символи, які тримають націю разом.",
    "ba-text-2":
      "Саме тому збереження навіть цифрового образу зруйнованого монумента важливе: він фіксує момент історії й дозволяє говорити про злочини проти культури.",

    "gallery-kicker": "фотогалерея",
    "gallery-title": "Кадри, що говорять без слів.",
    "gallery-subtitle":
      "Натисни на фото, щоб відкрити його у повноекранному режимі. Сюди можна додати світлини місцевих мешканців, журналістів, волонтерів.",
    "gallery-badge-1": "символ",
    "gallery-caption-1": "Погляд крізь уламки.",
    "gallery-badge-2": "простір",
    "gallery-caption-2": "Зміна міського ландшафту.",
    "gallery-badge-3": "деталі",
    "gallery-caption-3": "Сліди війни зблизька.",
    "gallery-badge-4": "люди",
    "gallery-caption-4": "Особисті історії поруч.",

    "memory-kicker": "пам’ять і відповідальність",
    "memory-title": "Digital-памʼятник, який можна нести далі.",
    "memory-text":
      "Цей макет можна перетворити на повноцінний онлайн-музей: додати інтерактивну карту, розділи про інші зруйновані об’єкти, інтерв’ю з мешканцями, архівні документи. Важливо, щоб історія Бородянки звучала не лише в новинах, а й у довготривалій культурній пам’яті.",
    "memory-quote":
      "«Борітеся — поборете, вам Бог помагає! За вас правда, за вас слава і воля святая!»",
    "memory-quote-author": "Тарас Шевченко",
    "memory-cta": "Додати свої історії та фото",

    "lightbox-hint": "Натисни поза вікном або клавішу Esc, щоб закрити.",

    "footer-left":
      "Цей сайт можна розгорнути як онлайн-музей зруйнованих культурних об’єктів Бородянки.",
    "footer-right":
      "Створено як digital-проєкт пам’яті про Тараса Шевченка та людей, які берегли його слово."
  },

  en: {
    "nav-brand-main": "Memory Borodianka",
    "nav-brand-sub": "Shevchenko Monument Story",
    "nav-link-about": "About the monument",
    "nav-link-timeline": "Timeline",
    "nav-link-beforeafter": "Before / After",
    "nav-link-gallery": "Gallery",
    "nav-link-memory": "Memory",
    "nav-cta": "View testimonies",

    "hero-kicker": "Borodianka · 2022 · memory of resilience",
    "hero-title-line1": "The Shevchenko monument",
    "hero-title-line2": "that shelling could not break.",
    "hero-subtitle":
      "In Borodianka, the bust of Taras Shevchenko was shot during Russian attacks, yet the poet’s face remained intact, becoming a symbol of resilience. This website is a digital space of memory about a strike on culture that failed.",
    "hero-cta-primary": "View the destruction",
    "hero-cta-secondary": "Learn the context",
    "hero-meta-1": "Real photos before and after shelling.",
    "hero-meta-2": "This site can be used as a base for an online museum.",

    "hero-card-label": "War against culture",
    "hero-card-time": "March 2022",
    "hero-thumb-before-label": "Before the invasion",
    "hero-thumb-after-label": "After the shelling",
    "hero-progress-title": "Documenting damage",
    "hero-progress-subtitle": "digital restoration of memory",

    "about-kicker": "about the monument",
    "about-title": "One monument — many readings of war.",
    "about-text-1":
      "Before the full-scale invasion, the Taras Shevchenko monument in Borodianka was a regular point on the town map: a meeting place, a backdrop for celebrations and group photos.",
    "about-text-2":
      "In March 2022, Russian forces shell Borodianka. The bust of Shevchenko is shot, yet the poet’s face miraculously remains intact. This image becomes one of the symbols of Ukraine’s resilience.",
    "about-text-3":
      "This site is not an official museum resource. It is an educational digital project that can be expanded with more photos, videos, testimonies, and links to sources.",
    "about-list-1": "Use it as a base for a school or university project.",
    "about-list-2": "Add a QR code in the town’s public space that leads here.",
    "about-list-3": "Extend it with sections on other destroyed sites in Borodianka.",

    "timeline-kicker": "timeline",
    "timeline-title": "How one pedestal became a symbol of resistance.",
    "timeline-item-1-label": "before the invasion",
    "timeline-item-1-text":
      "The monument is perceived as a regular element of the town’s landscape: people pass by without always noticing, yet it quietly reminds of a poet who wrote about freedom and dignity.",
    "timeline-item-2-label": "March 2022",
    "timeline-item-2-text":
      "During the Russian occupation of Borodianka, the monument is shot. The pedestal is damaged, fragments lie around, yet Shevchenko’s face remains — a silent reproach to the occupiers.",
    "timeline-item-3-label": "after liberation",
    "timeline-item-3-text":
      "Photos of the ruined monument spread across the world. Journalists, volunteers, and war researchers use this image to show that aggression targets identity itself.",
    "timeline-note":
      "For precise dates and references to documents, this layout can be enriched with archival materials, reports, and official investigations.",

    "ba-kicker": "visual testimony",
    "ba-title": "Before and after shelling.",
    "ba-subtitle":
      "Drag the slider to see how the space changes. On the left — what once was. On the right — what the war left behind.",
    "ba-label-before": "Before",
    "ba-label-after": "After",
    "ba-text-1":
      "Destroying monuments is not accidental. It is a deliberate attempt to erase the symbols that hold a nation together.",
    "ba-text-2":
      "That’s why preserving even a digital image of a destroyed monument matters: it records a moment in history and allows us to speak about crimes against culture.",

    "gallery-kicker": "photo gallery",
    "gallery-title": "Frames that need no words.",
    "gallery-subtitle":
      "Tap a photo to open it full screen. This space can host images by locals, journalists, and volunteers.",
    "gallery-badge-1": "symbol",
    "gallery-caption-1": "A gaze through the ruins.",
    "gallery-badge-2": "space",
    "gallery-caption-2": "A changed urban landscape.",
    "gallery-badge-3": "details",
    "gallery-caption-3": "Traces of war up close.",
    "gallery-badge-4": "people",
    "gallery-caption-4": "Personal stories nearby.",

    "memory-kicker": "memory and responsibility",
    "memory-title": "A digital monument that can travel further.",
    "memory-text":
      "This layout can become a full online museum: an interactive map, sections on other destroyed sites, interviews with locals, archival documents. It is important that Borodianka’s story lives not only in the news but in long-term cultural memory.",
    "memory-quote":
      "“Fight — and you will win. God himself will aid you. For truth and glory and holy freedom stand with you.”",
    "memory-quote-author": "Taras Shevchenko",
    "memory-cta": "Add your stories and photos",

    "lightbox-hint": "Click outside or press Esc to close.",

    "footer-left":
      "This site can be deployed as an online museum of destroyed cultural sites in Borodianka.",
    "footer-right":
      "Created as a digital memory project about Taras Shevchenko and the people who preserved his word."
  }
};

// ---- CORE ----
document.addEventListener("DOMContentLoaded", () => {
  let currentLang = localStorage.getItem("lang") || "ua";

  const langButtons = document.querySelectorAll(".lang-btn");

  function applyTranslations(lang) {
    const dict = translations[lang] || translations.ua;
    document.querySelectorAll("[data-i18n]").forEach((el) => {
      const key = el.getAttribute("data-i18n");
      const value = dict[key];
      if (!value) return;
      if (value.includes("<") || value.includes("&")) {
        el.innerHTML = value;
      } else {
        el.textContent = value;
      }
    });
  }

  function setActiveLangButton(lang) {
    langButtons.forEach((btn) => {
      btn.classList.toggle("active", btn.getAttribute("data-lang") === lang);
    });
  }

  langButtons.forEach((btn) => {
    btn.addEventListener("click", () => {
      const lang = btn.getAttribute("data-lang");
      if (lang === currentLang) return;
      currentLang = lang;
      localStorage.setItem("lang", lang);
      applyTranslations(lang);
      setActiveLangButton(lang);
      // оновити підпис у модальному, якщо відкрите
      const lightbox = document.getElementById("lightbox");
      if (lightbox && lightbox.classList.contains("open")) {
        const img = document.getElementById("lightbox-img");
        const captionEl = document.getElementById("lightbox-caption");
        const captionUA = img.getAttribute("data-caption-ua") || "";
        const captionEN = img.getAttribute("data-caption-en") || "";
        captionEl.textContent = lang === "ua" ? captionUA : captionEN;
      }
    });
  });

  applyTranslations(currentLang);
  setActiveLangButton(currentLang);

  // ---- HERO CTA scroll ----
  const navCta = document.querySelector(".nav-cta");
  if (navCta) {
    navCta.addEventListener("click", () => {
      const gallery = document.getElementById("gallery");
      if (gallery) gallery.scrollIntoView({ behavior: "smooth" });
    });
  }

  // ---- BEFORE / AFTER SLIDER ----
  const baSlider = document.getElementById("baSlider");
  const baAfter = document.querySelector(".ba-img-after");
  const baHandle = document.querySelector(".ba-handle");

  function updateBA(value) {
    const v = Math.max(0, Math.min(100, Number(value)));
    const clip = `polygon(${v}% 0,100% 0,100% 100%,${v}% 100%)`;
    if (baAfter) baAfter.style.clipPath = clip;
    if (baHandle) baHandle.style.left = v + "%";
  }

  if (baSlider && baAfter) {
    updateBA(baSlider.value);
    baSlider.addEventListener("input", (e) => {
      updateBA(e.target.value);
    });
  }

  // ---- GALLERY LIGHTBOX ----
  const lightbox = document.getElementById("lightbox");
  const lightboxImg = document.getElementById("lightbox-img");
  const lightboxCaption = document.getElementById("lightbox-caption");
  const lightboxClose = document.querySelector(".lightbox-close");

  document.querySelectorAll(".gallery-item").forEach((item) => {
    item.addEventListener("click", () => {
      const img = item.querySelector("img");
      const full = item.getAttribute("data-full") || img.src;
      const captionUA = item.getAttribute("data-caption-ua") || "";
      const captionEN = item.getAttribute("data-caption-en") || "";

      lightboxImg.src = full;
      lightboxImg.setAttribute("data-caption-ua", captionUA);
      lightboxImg.setAttribute("data-caption-en", captionEN);
      lightboxCaption.textContent = currentLang === "ua" ? captionUA : captionEN;

      lightbox.classList.add("open");
      lightbox.setAttribute("aria-hidden", "false");
    });
  });

  function closeLightbox() {
    lightbox.classList.remove("open");
    lightbox.setAttribute("aria-hidden", "true");
    lightboxImg.src = "";
  }

  if (lightboxClose) {
    lightboxClose.addEventListener("click", closeLightbox);
  }

  if (lightbox) {
    lightbox.addEventListener("click", (e) => {
      if (e.target === lightbox) closeLightbox();
    });
  }

  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape" && lightbox.classList.contains("open")) {
      closeLightbox();
    }
  });

  // ---- REVEAL ON SCROLL ----
  const revealEls = document.querySelectorAll(".reveal");
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add("visible");
          observer.unobserve(entry.target);
        }
      });
    },
    { threshold: 0.15 }
  );
  revealEls.forEach((el) => observer.observe(el));
});
